<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>G√™nesis ‚Äî Ingl√™s com Tradu√ß√£o</title>
<style>
body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 2rem; max-width: 800px; margin: auto; }
.verse { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 1rem; margin-bottom: 1.5rem; }
h2 { color: #333; }
.text { margin: 0.5rem 0; }
.word { transition: color 0.1s; }
button { margin-top: 0.5rem; padding: 0.3rem 0.6rem; margin-right: 0.3rem; cursor: pointer; }
.pt-text { display: none; margin-top: 0.5rem; color: #444; }
</style>
</head>
<body>
<h1>üìñ G√™nesis ‚Äî Ingl√™s com Tradu√ß√£o</h1>
<div id="container"></div>
<button onclick="playAllEnglish()">‚ñ∂Ô∏è Tocar Todos em Ingl√™s</button>
<button onclick="pauseAudio()">‚è∏Ô∏è Pausar</button>
<button onclick="resumeAudio()">‚ñ∂Ô∏è Retomar</button>

<script>
const verses = [
  {
    ref: "G√™nesis 1:1",
    enText: "In the beginning God created the heavens and the earth.",
    ptText: "No princ√≠pio Deus criou os c√©us e a terra.",
    enFile: "genesis-1-1-en.mp3"
  },
  {
    ref: "G√™nesis 1:2",
    enText: "Now the earth was formless and desolate, and there was darkness upon the surface of the watery deep, and God‚Äôs active force was moving about over the surface of the waters.",
    ptText: "A terra era vazia e deserta, e havia escurid√£o sobre as √°guas profundas; e a for√ßa ativa de Deus movia-se sobre as √°guas.",
    enFile: "genesis-1-2-en.mp3"
  },
  {
    ref: "G√™nesis 1:3",
    enText: "And God said, 'Let there be light,' and there was light.",
    ptText: "Ent√£o Deus disse: 'Que haja luz.' E houve luz.",
    enFile: "genesis-1-3-en.mp3"
  }
];

const container = document.getElementById("container");
let currentAudio = null;
let currentWords = [];
let currentWordIndex = 0;
let currentTimers = [];
let verseIndex = 0;

// Cria spans de palavras
function createWordSpans(text, id){
  const words = text.match(/\S+|\n/g) || [];
  return words.map((w,i)=>`<span class="word" id="${id}-w${i}">${w}</span>`).join(" ");
}

// Cria interface dos versos
verses.forEach((v,index)=>{
  const div = document.createElement("div");
  div.className = "verse";
  div.innerHTML = `
    <h2>${v.ref}</h2>
    <p class="text" id="en-${index}"><strong>EN:</strong> ${createWordSpans(v.enText,'en-'+index)}</p>
    <button onclick="playAudio('en-${index}','${v.enFile}')">‚ñ∂Ô∏è Falar EN</button>
    <button onclick="pauseAudio()">‚è∏Ô∏è Pausar</button>
    <button onclick="resumeAudio()">‚ñ∂Ô∏è Retomar</button>
    <button onclick="toggleTranslation('pt-${index}')">üåç Tradu√ß√£o</button>
    <p class="pt-text" id="pt-${index}"><strong>PT:</strong> ${v.ptText}</p>
  `;
  container.appendChild(div);
});

// Fun√ß√£o para mostrar/ocultar tradu√ß√£o
function toggleTranslation(id){
  const el = document.getElementById(id);
  if(el.style.display === "none" || el.style.display === ""){
    el.style.display = "block";
  } else {
    el.style.display = "none";
  }
}

function resetHighlight(){
  if(currentWords){
    currentWords.forEach(w=>w.style.color='black');
  }
}

function clearTimers(){
  currentTimers.forEach(t=>clearTimeout(t));
  currentTimers = [];
}

// Fun√ß√£o para tocar um verso em ingl√™s com highlight
function playAudio(textId,file,callback){
  if(currentAudio){
    currentAudio.pause();
    resetHighlight();
    clearTimers();
  }

  const textEl = document.getElementById(textId);
  currentWords = textEl.querySelectorAll(".word");
  currentWords.forEach(w=>w.style.color='black');
  currentWordIndex = 0;

  currentAudio = new Audio(file);

  currentAudio.addEventListener('loadedmetadata',()=>{
    const totalTime = currentAudio.duration;
    const chars = Array.from(currentWords).map(w=>w.innerText.length);
    const totalChars = chars.reduce((a,b)=>a+b,0);
    const timings = chars.map(c => (c/totalChars)*totalTime*1000); // ms aproximados por palavra

    let elapsed = 0;
    currentWords.forEach((w,i)=>{
      const timer = setTimeout(()=>{
        if(i>0) currentWords[i-1].style.color='black';
        currentWords[i].style.color='red';
        currentWordIndex = i;
      }, elapsed);
      currentTimers.push(timer);
      elapsed += timings[i];
    });

    const endTimer = setTimeout(()=>{
      resetHighlight();
      currentAudio=null;
      clearTimers();
      if(callback) callback(); // chama o pr√≥ximo verso
    }, elapsed + 100);
    currentTimers.push(endTimer);

    currentAudio.play();
  });
}

// Fun√ß√£o para tocar todos os versos em sequ√™ncia
function playAllEnglish(){
  verseIndex = 0;
  function playNext(){
    if(verseIndex < verses.length){
      playAudio(`en-${verseIndex}`, verses[verseIndex].enFile, ()=>{
        verseIndex++;
        playNext();
      });
    }
  }
  playNext();
}

// Pausar e retomar
function pauseAudio(){
  if(currentAudio){
    currentAudio.pause();
    clearTimers();
  }
}

function resumeAudio(){
  if(currentAudio && currentWordIndex < currentWords.length){
    const remainingWords = Array.from(currentWords).slice(currentWordIndex);
    const totalTime = currentAudio.duration - currentAudio.currentTime;
    const chars = remainingWords.map(w=>w.innerText.length);
    const totalChars = chars.reduce((a,b)=>a+b,0);
    const timings = chars.map(c => (c/totalChars)*totalTime*1000);

    let elapsed = 0;
    remainingWords.forEach((w,i)=>{
      const timer = setTimeout(()=>{
        if(i>0) remainingWords[i-1].style.color='black';
        w.style.color='red';
        currentWordIndex++;
      }, elapsed);
      currentTimers.push(timer);
      elapsed += timings[i];
    });

    const endTimer = setTimeout(()=>{
      resetHighlight();
      currentAudio=null;
      clearTimers();
      verseIndex++;
      if(verseIndex < verses.length) playAllEnglish();
    }, elapsed + 100);
    currentTimers.push(endTimer);

    currentAudio.play();
  }
}
</script>
</body>
</html>
