<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Áudios de Gênesis</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 2rem; max-width: 700px; margin: auto; }
    .verse { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 1rem; margin-bottom: 1.5rem; }
    h2 { color: #333; }
    audio { width: 100%; margin-top: 0.5rem; }
    .word { transition: color 0.2s ease; }
    .highlight { color: red; }
    .controls button { margin-right: 0.5rem; }
  </style>
</head>
<body>
  <h1>📖 Gênesis — Áudio em Inglês e Tradução</h1>
  <button id="playAll">▶️ Tocar todos em Inglês</button>
  <div id="container"></div>

  <script>
    const verses = [
      {
        ref: "Gênesis 1:1",
        enText: "In the beginning God created the heavens and the earth.",
        ptText: "No princípio Deus criou os céus e a terra.",
        enFile: "genesis-1-1-en.mp3",
        ptFile: "genesis-1-1-pt.mp3"
      },
      {
        ref: "Gênesis 1:2",
        enText: "Now the earth was formless and desolate, and there was darkness upon the surface of the watery deep, and God’s active force was moving about over the surface of the waters.",
        ptText: "A terra era vazia e deserta, e havia escuridão sobre as águas profundas; e a força ativa de Deus movia-se sobre as águas.",
        enFile: "genesis-1-2-en.mp3",
        ptFile: "genesis-1-2-pt.mp3"
      },
      {
        ref: "Gênesis 1:3",
        enText: "And God said, 'Let there be light,' and there was light.",
        ptText: "Então Deus disse: 'Que haja luz.' E houve luz.",
        enFile: "genesis-1-3-en.mp3",
        ptFile: "genesis-1-3-pt.mp3"
      }
    ];

    const container = document.getElementById("container");
    let currentAudio = null;
    let rafId = null;

    function renderTextWithSpans(text) {
      return text.split(" ").map(w => `<span class="word">${w}</span>`).join(" ");
    }

    verses.forEach((v, i) => {
      const div = document.createElement("div");
      div.className = "verse";
      div.innerHTML = `
        <h2>${v.ref}</h2>
        <p class="en" id="en-${i}">${renderTextWithSpans(v.enText)}</p>
        <div class="controls">
          <button onclick="playVerse(${i})">▶️ Play</button>
          <button onclick="togglePause(${i})">⏸️ Pause/Resume</button>
          <button onclick="toggleTranslation(${i})">🌐 Tradução</button>
        </div>
        <p class="pt" id="pt-${i}" style="display:none;">${v.ptText}</p>
        <audio id="audio-${i}" src="${v.enFile}"></audio>
      `;
      container.appendChild(div);
    });

    function playVerse(index) {
      if (currentAudio) {
        cancelAnimationFrame(rafId);
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }

      currentAudio = document.getElementById(`audio-${index}`);
      const textElement = document.getElementById(`en-${index}`);
      const words = textElement.querySelectorAll(".word");

      // limpa estilos
      words.forEach(w => w.classList.remove("highlight"));

      currentAudio.play();
      syncWords(currentAudio, words);

      currentAudio.onended = () => {
        cancelAnimationFrame(rafId);
        words.forEach(w => w.classList.remove("highlight"));
      };
    }

    function togglePause(index) {
      if (!currentAudio) return;
      if (currentAudio.paused) {
        currentAudio.play();
        syncWords(currentAudio, document.getElementById(`en-${index}`).querySelectorAll(".word"));
      } else {
        currentAudio.pause();
        cancelAnimationFrame(rafId);
      }
    }

    function toggleTranslation(index) {
      const pt = document.getElementById(`pt-${index}`);
      pt.style.display = pt.style.display === "none" ? "block" : "none";
    }

    function syncWords(audio, words) {
      function step() {
        if (!audio.paused) {
          const progress = audio.currentTime / audio.duration;
          const wordIndex = Math.floor(progress * words.length);
          words.forEach((w, i) => {
            w.classList.toggle("highlight", i === wordIndex);
          });
        }
        rafId = requestAnimationFrame(step);
      }
      step();
    }

    // Play All
    document.getElementById("playAll").addEventListener("click", async () => {
      for (let i = 0; i < verses.length; i++) {
        await new Promise(resolve => {
          playVerse(i);
          currentAudio.onended = resolve;
        });
      }
    });
  </script>
</body>
</html>
