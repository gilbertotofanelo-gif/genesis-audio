<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Áudios de Gênesis</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 2rem; max-width: 700px; margin: auto; }
    .verse { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 1rem; margin-bottom: 1.5rem; }
    h2 { color: #333; }
    audio { width: 100%; margin-top: 0.5rem; }
    .word { transition: color 0.2s ease; }
    .highlight { color: red; }
    .controls button { margin-right: 0.5rem; }
  </style>
</head>
<body>
  <h1>📖 Gênesis — Áudio em Inglês e Tradução</h1>
  <button id="playAll">▶️ Tocar todos em Inglês</button>
  <div id="container"></div>

  <script>
    const verses = [
      {
        ref: "Gênesis 1:1",
        enText: "In the beginning God created the heavens and the earth.",
        ptText: "No princípio Deus criou os céus e a terra.",
        enFile: "genesis-1-1-en.mp3",
        ptFile: "genesis-1-1-pt.mp3"
      },
      {
        ref: "Gênesis 1:2",
        enText: "Now the earth was formless and desolate, and there was darkness upon the surface of the watery deep, and God’s active force was moving about over the surface of the waters.",
        ptText: "A terra era vazia e deserta, e havia escuridão sobre as águas profundas; e a força ativa de Deus movia-se sobre as águas.",
        enFile: "genesis-1-2-en.mp3",
        ptFile: "genesis-1-2-pt.mp3"
      },
      {
        ref: "Gênesis 1:3",
        enText: "And God said, 'Let there be light,' and there was light.",
        ptText: "Então Deus disse: 'Que haja luz.' E houve luz.",
        enFile: "genesis-1-3-en.mp3",
        ptFile: "genesis-1-3-pt.mp3"
      }
    ];

    const container = document.getElementById("container");
    let currentAudio = null;
    let currentWordIndex = 0;
    let wordTimers = [];
    let isPaused = false;
    let pauseTime = 0;

    function renderTextWithSpans(text) {
      return text.split(" ").map(w => `<span class="word">${w}</span>`).join(" ");
    }

    verses.forEach((v, i) => {
      const div = document.createElement("div");
      div.className = "verse";
      div.innerHTML = `
        <h2>${v.ref}</h2>
        <p class="en" id="en-${i}">${renderTextWithSpans(v.enText)}</p>
        <div class="controls">
          <button onclick="playVerse(${i})">▶️ Play</button>
          <button onclick="togglePause(${i})">⏸️ Pause/Resume</button>
          <button onclick="toggleTranslation(${i})">🌐 Tradução</button>
        </div>
        <p class="pt" id="pt-${i}" style="display:none;">${v.ptText}</p>
        <audio id="audio-${i}" src="${v.enFile}"></audio>
      `;
      container.appendChild(div);
    });

    function playVerse(index) {
      clearTimers();
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }
      currentAudio = document.getElementById(`audio-${index}`);
      const textElement = document.getElementById(`en-${index}`);
      highlightWords(textElement, verses[index].enText, currentAudio);
      currentAudio.play();
    }

    function togglePause(index) {
      if (!currentAudio) return;
      if (currentAudio.paused) {
        currentAudio.play();
        isPaused = false;
      } else {
        currentAudio.pause();
        isPaused = true;
      }
    }

    function toggleTranslation(index) {
      const pt = document.getElementById(`pt-${index}`);
      pt.style.display = pt.style.display === "none" ? "block" : "none";
    }

    function highlightWords(element, text, audio) {
      const words = element.querySelectorAll(".word");
      words.forEach(w => w.classList.remove("highlight"));

      const duration =  audio.duration > 0 ? audio.duration : 5; // fallback
      const wordDuration = duration / words.length;

      currentWordIndex = 0;
      wordTimers = [];

      words.forEach((word, i) => {
        const timer = setTimeout(() => {
          words.forEach(w => w.classList.remove("highlight"));
          word.classList.add("highlight");
        }, i * wordDuration * 1000);
        wordTimers.push(timer);
      });

      audio.onended = () => {
        clearTimers();
        words.forEach(w => w.classList.remove("highlight"));
      };
    }

    function clearTimers() {
      wordTimers.forEach(t => clearTimeout(t));
      wordTimers = [];
    }

    // Play All in English
    document.getElementById("playAll").addEventListener("click", async () => {
      for (let i = 0; i < verses.length; i++) {
        await new Promise(resolve => {
          playVerse(i);
          currentAudio.onended = resolve;
        });
      }
    });
  </script>
</body>
</html>
