<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Audio de G√™nesis</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      max-width: 700px;
      margin: auto;
    }
    .verse {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    h2 { color: #333; }
    audio { width: 100%; margin-top: 0.5rem; }
    .word { transition: color 0.2s ease; cursor: pointer; }
    .highlight { color: red; font-weight: bold; }
    .controls button, .controls select {
      margin-right: 0.5rem;
      margin-top: 0.5rem;
    }
    .global-controls {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .global-controls button {
      margin: 0 0.5rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      background-color: #673ab7;
      color: white;
    }
    .global-controls button:hover {
      background-color: #5e35b1;
    }
    .ref-title {
      font-size: 12px;
      color: red;
    }
  </style>
</head>
<body>
  <h1 style="font-size: 18px; text-align: center; margin-bottom: 1rem;">
    üìñ G√™nesis ‚Äî Ingl√™s e Portugu√™s
  </h1>
  <div style="text-align: center; margin-top: 20px;">
    <button id="playAllEN" style="font-size:12px;">‚ñ∂Ô∏è Todos/Ingl√™s</button>
    <button id="playAllPT" style="font-size:12px; background-color:#4caf50; color:white;">‚ñ∂Ô∏è Todos/Portugu√™s</button>
  </div>

  <div id="container"></div>

  <script>
    const verses = [
      {
        ref: "G√™nesis 1:1",
        enText: "In the beginning God created the heavens and the earth.",
        ptText: "No princ√≠pio Deus criou os c√©us e a terra.",
        enFile: "genesis-1-1-en.mp3",
        ptFile: "genesis-1-1-pt.mp3"
      },
      {
        ref: "G√™nesis 1:2",
        enText: "Now the earth was formless and desolate, and there was darkness upon the surface of the watery deep, and God‚Äôs active force was moving about over the surface of the waters.",
        ptText: "A terra era vazia e deserta, e havia escurid√£o sobre as √°guas profundas; e a for√ßa ativa de Deus movia-se sobre as √°guas.",
        enFile: "genesis-1-2-en.mp3",
        ptFile: "genesis-1-2-pt.mp3"
      },
      {
        ref: "G√™nesis 1:3",
        enText: "And God said, 'Let there be light,' and there was light.",
        ptText: "Ent√£o Deus disse: 'Que haja luz.' E houve luz.",
        enFile: "genesis-1-3-en.mp3",
        ptFile: "genesis-1-3-pt.mp3"
      }
    ];

    const container = document.getElementById("container");
    let currentAudio = null;
    let rafId = null;

    function renderTextWithSpans(text) {
      return text.split(" ").map(w => `<span class="word">${w}</span>`).join(" ");
    }

    verses.forEach((v, i) => {
      const div = document.createElement("div");
      div.className = "verse";
      div.innerHTML = `
        <h2 class="ref-title">${v.ref}</h2>
        <p class="en" id="en-${i}">${renderTextWithSpans(v.enText)}</p>
        <div class="controls">
          <button style="background-color:#4caf50; color:white;" onclick="toggleTranslation(${i})">üåê Tradu√ß√£o</button>
          <button id="toggle-en-${i}" onclick="togglePlayPause(${i}, 'en', this)">‚ñ∂Ô∏è Play</button>
          <label for="speed-en-${i}" style="font-size:12px;">Velocidade:</label>
          <select id="speed-en-${i}" onchange="changeSpeed(${i}, 'en', this.value)">
            <option value="0.75">0.75x</option>
            <option value="1" selected>1x</option>
            <option value="1.25">1.25x</option>
            <option value="1.5">1.5x</option>
          </select>
        </div>
        <div id="pt-wrapper-${i}" style="display:none;">
          <p class="pt" id="pt-${i}">${renderTextWithSpans(v.ptText)}</p>
          <div class="controls">
            <button id="toggle-pt-${i}" style="background-color:#4caf50; color:white;" onclick="togglePlayPause(${i}, 'pt', this)">‚ñ∂Ô∏è Play</button>
            <label for="speed-pt-${i}" style="font-size:12px;"></label>
            <select id="speed-pt-${i}" onchange="changeSpeed(${i}, 'pt', this.value)">
              <option value="0.75">0.75x</option>
              <option value="1" selected>1x</option>
              <option value="1.25">1.25x</option>
              <option value="1.5">1.5x</option>
            </select>
          </div>
        </div>
        <audio id="audio-en-${i}" src="${v.enFile}"></audio>
        <audio id="audio-pt-${i}" src="${v.ptFile}"></audio>
      `;
      container.appendChild(div);
    });

    function togglePlayPause(index, lang, btn) {
      const audio = document.getElementById(`audio-${lang}-${index}`);
      const words = document.getElementById(`${lang}-${index}`).querySelectorAll(".word");

      // clique em palavra ‚Üí pula no √°udio
      words.forEach((word, i) => {
        word.onclick = () => {
          if (audio.duration > 0) {
            audio.currentTime = (i / words.length) * audio.duration;
            if (audio.paused) audio.play();
          }
        };
      });

      if (audio.paused) {
        audio.play();
        btn.textContent = "‚è∏Ô∏è Pause";
        syncWords(audio, words);
      } else {
        audio.pause();
        btn.textContent = "‚ñ∂Ô∏è Play";
        cancelAnimationFrame(rafId);
      }

      audio.onended = () => {
        cancelAnimationFrame(rafId);
        words.forEach(w => w.classList.remove("highlight"));
        btn.textContent = "‚ñ∂Ô∏è Play";
      };

      currentAudio = audio;
    }

    function toggleTranslation(index) {
      const wrapper = document.getElementById(`pt-wrapper-${index}`);
      wrapper.style.display = wrapper.style.display === "none" ? "block" : "none";
    }

    function syncWords(audio, words) {
      function step() {
        if (!audio.paused && audio.duration > 0) {
          const progress = audio.currentTime / audio.duration;
          const wordIndex = Math.floor(progress * words.length);
          words.forEach((w, i) => {
            w.classList.toggle("highlight", i === wordIndex);
          });
        }
        rafId = requestAnimationFrame(step);
      }
      step();
    }

    function changeSpeed(index, lang, value) {
      const audio = document.getElementById(`audio-${lang}-${index}`);
      audio.playbackRate = parseFloat(value);
    }

    document.getElementById("playAllEN").addEventListener("click", async () => {
      for (let i = 0; i < verses.length; i++) {
        await new Promise(resolve => {
          togglePlayPause(i, 'en', document.getElementById(`toggle-en-${i}`));
          currentAudio.onended = resolve;
        });
      }
    });

    document.getElementById("playAllPT").addEventListener("click", async () => {
      for (let i = 0; i < verses.length; i++) {
        await new Promise(resolve => {
          togglePlayPause(i, 'pt', document.getElementById(`toggle-pt-${i}`));
          currentAudio.onended = resolve;
        });
      }
    });
  </script>
</body>
</html>
