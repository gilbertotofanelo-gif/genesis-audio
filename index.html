<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Áudio de Gênesis</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      max-width: 700px;
      margin: auto;
    }
    p {
      font-size: 1.2rem;
      line-height: 1.6;
    }
    .word {
      cursor: pointer;
      padding: 2px;
    }
    .highlight {
      color: red;
    }
    .bold-paragraph {
      font-weight: bold;
    }
    button {
      margin: 4px;
      padding: 6px 12px;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Áudio de Gênesis</h1>
  <div id="controls">
    <button id="playAllEN">▶️ Todos EN</button>
    <button id="playAllPT">▶️ Todos PT</button>
  </div>
  <div id="content"></div>

  <script>
    const verses = [
      {
        en: "In the beginning God created the heavens and the earth.",
        pt: "No princípio Deus criou os céus e a terra."
      },
      {
        en: "Now the earth was formless and empty, darkness was over the surface of the deep.",
        pt: "A terra era sem forma e vazia, havia trevas sobre a face do abismo."
      },
      {
        en: "And the Spirit of God was hovering over the waters.",
        pt: "E o Espírito de Deus pairava sobre as águas."
      }
    ];

    const contentDiv = document.getElementById("content");

    // renderiza versículos
    verses.forEach((verse, index) => {
      ["en", "pt"].forEach(lang => {
        const paragraph = document.createElement("p");
        paragraph.id = `${lang}-${index}`;
        paragraph.innerHTML = verse[lang]
          .split(" ")
          .map(word => `<span class="word">${word}</span>`)
          .join(" ");
        contentDiv.appendChild(paragraph);

        const audio = document.createElement("audio");
        audio.id = `audio-${lang}-${index}`;
        audio.src = `audios/${lang}-${index}.mp3`; // coloque seus áudios aqui
        contentDiv.appendChild(audio);

        const btn = document.createElement("button");
        btn.id = `toggle-${lang}-${index}`;
        btn.textContent = "▶️ Play";
        btn.onclick = () => togglePlayPause(index, lang, btn);
        contentDiv.appendChild(btn);
      });
    });

    let currentAudio = null;
    let rafId;
    let resolveNext = null; // usado no modo "Todos"

    function syncWords(audio, words) {
      function step() {
        const currentTime = audio.currentTime;
        const duration = audio.duration;
        const wordIndex = Math.floor((currentTime / duration) * words.length);

        words.forEach((w, i) => {
          w.classList.toggle("highlight", i === wordIndex);
        });

        if (!audio.paused) {
          rafId = requestAnimationFrame(step);
        }
      }
      step();
    }

    function togglePlayPause(index, lang, btn) {
      const audio = document.getElementById(`audio-${lang}-${index}`);
      const paragraph = document.getElementById(`${lang}-${index}`);
      const words = paragraph.querySelectorAll(".word");

      // clique em palavra → pula no áudio
      words.forEach((word, i) => {
        word.onclick = () => {
          if (audio.duration > 0) {
            audio.currentTime = (i / words.length) * audio.duration;
            if (audio.paused) audio.play();
          }
        };
      });

      if (audio.paused) {
        audio.play();
        btn.textContent = "⏸️ Pause";
        paragraph.classList.add("bold-paragraph");
        syncWords(audio, words);
      } else {
        audio.pause();
        btn.textContent = "▶️ Play";
        cancelAnimationFrame(rafId);
      }

      audio.onended = () => {
        cancelAnimationFrame(rafId);
        words.forEach(w => w.classList.remove("highlight"));
        paragraph.classList.remove("bold-paragraph");
        btn.textContent = "▶️ Play";

        // se estiver no modo "Todos", avança
        if (typeof resolveNext === "function") {
          resolveNext();

          // rola para o próximo parágrafo
          setTimeout(() => {
            const nextParagraph = document.getElementById(`${lang}-${index + 1}`);
            if (nextParagraph) {
              nextParagraph.scrollIntoView({
                behavior: "smooth",
                block: "start"
              });
            }
          }, 300);
        }
      };

      currentAudio = audio;
    }

    // play todos em inglês
    document.getElementById("playAllEN").addEventListener("click", async () => {
      for (let i = 0; i < verses.length; i++) {
        await new Promise(resolve => {
          resolveNext = resolve;
          togglePlayPause(i, "en", document.getElementById(`toggle-en-${i}`));
        });
      }
    });

    // play todos em português
    document.getElementById("playAllPT").addEventListener("click", async () => {
      for (let i = 0; i < verses.length; i++) {
        await new Promise(resolve => {
          resolveNext = resolve;
          togglePlayPause(i, "pt", document.getElementById(`toggle-pt-${i}`));
        });
      }
    });
  </script>
</body>
</html>
