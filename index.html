<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GÃªnesis â€” MP3 com Highlight AvanÃ§ado</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 2rem; max-width: 700px; margin: auto; }
    .verse { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 1rem; margin-bottom: 1.5rem; }
    h2 { color: #333; }
    .text { margin: 0.5rem 0; }
    .word { transition: color 0.1s; }
    button { margin-top: 0.5rem; padding: 0.3rem 0.6rem; }
  </style>
</head>
<body>
  <h1>ðŸ“– GÃªnesis â€” MP3 com Highlight AvanÃ§ado</h1>
  <div id="container"></div>

  <script>
    const verses = [
      {
        ref: "GÃªnesis 1:1",
        enText: "In the beginning God created the heavens and the earth.",
        ptText: "No princÃ­pio Deus criou os cÃ©us e a terra.",
        enFile: "genesis-1-1-en.mp3",
        ptFile: "genesis-1-1-pt.mp3"
      },
      {
        ref: "GÃªnesis 1:2",
        enText: "Now the earth was formless and desolate, and there was darkness upon the surface of the watery deep, and Godâ€™s active force was moving about over the surface of the waters.",
        ptText: "A terra era vazia e deserta, e havia escuridÃ£o sobre as Ã¡guas profundas; e a forÃ§a ativa de Deus movia-se sobre as Ã¡guas.",
        enFile: "genesis-1-2-en.mp3",
        ptFile: "genesis-1-2-pt.mp3"
      },
      {
        ref: "GÃªnesis 1:3",
        enText: "And God said, 'Let there be light,' and there was light.",
        ptText: "EntÃ£o Deus disse: 'Que haja luz.' E houve luz.",
        enFile: "genesis-1-3-en.mp3",
        ptFile: "genesis-1-3-pt.mp3"
      }
    ];

    const container = document.getElementById("container");

    function createWordSpans(text, id) {
      // separa palavras incluindo pontuaÃ§Ã£o
      const words = text.match(/\S+|\n/g) || [];
      return words.map((w, i) => `<span class="word" id="${id}-w${i}">${w}</span>`).join(" ");
    }

    verses.forEach((v, index) => {
      const div = document.createElement("div");
      div.className = "verse";
      div.innerHTML = `
        <h2>${v.ref}</h2>

        <p class="text" id="en-${index}"><strong>EN:</strong> ${createWordSpans(v.enText, 'en-'+index)}</p>
        <button onclick="playAudio('en-${index}', '${v.enFile}')">ðŸ”Š Falar EN</button>

        <p class="text" id="pt-${index}"><strong>PT:</strong> ${createWordSpans(v.ptText, 'pt-'+index)}</p>
        <button onclick="playAudio('pt-${index}', '${v.ptFile}')">ðŸ”Š Falar PT</button>
      `;
      container.appendChild(div);
    });

    function playAudio(textId, file) {
      const audio = new Audio(file);
      const textEl = document.getElementById(textId);
      const words = textEl.querySelectorAll(".word");
      words.forEach(w => w.style.color = "black"); // reset

      audio.addEventListener('loadedmetadata', () => {
        const totalTime = audio.duration;

        // soma dos comprimentos das palavras
        const totalChars = Array.from(words).reduce((sum, w) => sum + w.innerText.length, 0);
        
        // calcula tempo proporcional para cada palavra
        const timings = Array.from(words).map(w => (w.innerText.length / totalChars) * totalTime * 1000);

        let currentWord = 0;

        function highlightNext() {
          if(currentWord > 0) words[currentWord-1].style.color = "black";
          if(currentWord < words.length) {
            words[currentWord].style.color = "red";
            setTimeout(highlightNext, timings[currentWord]);
            currentWord++;
          }
        }

        audio.play();
        highlightNext();

        audio.onended = () => {
          words.forEach(w => w.style.color = "black");
        };
      });
    }
  </script>
</body>
</html>

